var html5Upload=function(){"use strict";function a(a){var b=this;b.dropContainer=a.dropContainer,b.inputField=a.inputField,b.uploadsQueue=[],b.activeUploads=0,b.data=a.data,b.key=a.key,b.maxSimultaneousUploads=a.maxSimultaneousUploads||-1,b.onFileAdded=a.onFileAdded||e,b.uploadUrl=a.uploadUrl,b.onFileAddedProxy=function(a){f.log("Event: onFileAdded, file: "+a.fileName),b.onFileAdded(a)},b.initialize()}function b(a){var b=this;b.file=a,b.fileName=a.name,b.fileSize=a.size,b.uploadSize=a.size,b.uploadedBytes=0,b.eventHandlers={},b.events={onProgress:function(a,c){var d=c/a*100;f.log("Event: upload onProgress, progress = "+d+", fileSize = "+a+", uploadedBytes = "+c),(b.eventHandlers.onProgress||e)(d,a,c)},onStart:function(){f.log("Event: upload onStart"),(b.eventHandlers.onStart||e)()},onCompleted:function(c){f.log("Event: upload onCompleted, data = "+c),a=null,(b.eventHandlers.onCompleted||e)(c)}}}var c,d={},e=function(){},f=window.console||{log:e};return b.prototype={on:function(a){this.eventHandlers=a}},a.prototype={initialize:function(){var a=this,b=a.dropContainer,c=a.inputField,d=function(a){a.preventDefault(),a.stopPropagation()},e=function(a){d(a),b.classList.add("drag-over")},f=function(a){d(a),b.classList.remove("drag-over")};b&&(a.on(b,"dragenter",e),a.on(b,"dragover",e),a.on(b,"dragleave",f),a.on(b,"drop",function(b){d(b),f(b),a.processFiles(b.dataTransfer.files)})),c&&a.on(c,"change",function(){a.processFiles(this.files)})},processFiles:function(a){f.log("Processing files: "+a.length);var c,d,e,g=this,h=a.length;for(e=0;h>e;e+=1){if(c=a[e],0===c.size){alert("Files with files size zero cannot be uploaded or multiple file uploads are not supported by your browser");break}d=new b(c),g.uploadFile(d)}},uploadFile:function(a){var b=this;return b.onFileAdded(a),b.activeUploads===b.maxSimultaneousUploads?(f.log("Queue upload: "+a.fileName),void b.uploadsQueue.push(a)):void b.ajaxUpload(a)},ajaxUpload:function(a){var b,c,d,e,g=this,h=a.file,i=g.data,j=g.key||"file";if(f.log("Beging upload: "+a.fileName),g.activeUploads+=1,b=new window.XMLHttpRequest,c=new window.FormData,d=h.name,b.open("POST",g.uploadUrl),b.upload.onloadstart=function(){f.log("Upload started: "+d),a.events.onStart()},b.upload.onprogress=function(b){b.lengthComputable&&a.events.onProgress(b.total,b.loaded)},b.onload=function(b){f.log("Upload completed: "+d),g.activeUploads-=1,a.events.onCompleted(b.target.responseText),g.uploadsQueue.length&&g.ajaxUpload(g.uploadsQueue.shift())},b.onerror=function(){f.log("Upload failed: ",a.fileName)},i)for(e in i)i.hasOwnProperty(e)&&(f.log("Adding data: "+e+" = "+i[e]),c.append(e,i[e]));c.append(j,h),b.send(c)},on:function(a,b,c){a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)}},d.fileApiSupported=function(){if("boolean"!=typeof c){var a=document.createElement("input");a.setAttribute("type","file"),c=!!a.files}return c},d.initialize=function(b){return new a(b)},d}(),matches=function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)},getClosest=function(a,b){for(;a&&a!==document;a=a.parentNode)if(matches(a,b))return a;return!1},getParents=function(a,b){for(var c=[];a&&a!==document;a=a.parentNode)(!b||b&&matches(a,b))&&c.push(a);return c.length?c:null},AJAX=function(){function a(){this.x=new XMLHttpRequest}return a.prototype.send=function(a,b,c,d,e,f){void 0===e&&(e=!0),void 0===f&&(f=[]);var g=this;if(this.x.open(a,b,e),this.x.onreadystatechange=function(){4==g.x.readyState&&d(this.responseText)},"POST"==a&&this.x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),void 0!==f&&null!==f&&void 0!==f.length&&f.length)for(var h=0;h<f.length;h++){var i=f[h];for(var j in i)i.hasOwnProperty(j)&&this.x.setRequestHeader(j,i[j])}this.x.send(c)},a.prototype.get=function(a,b,c,d,e){void 0===d&&(d=!0),void 0===e&&(e=[]);var f=[];for(var g in b)f.push(encodeURIComponent(g)+"="+encodeURIComponent(b[g]));this.send("GET",a+(a.indexOf("?")>0?"&":"?")+f.join("&"),null,c,d,e)},a.prototype.post=function(a,b,c,d){void 0===d&&(d=!0);var e=[];for(var f in b)e.push(encodeURIComponent(f)+"="+encodeURIComponent(b[f]));this.send("POST",a,e.join("&"),c,d,void 0!==b.headers?b.headers:null)},a.prototype.setHeaders=function(a){for(var b=0;b<a.length;b++){var c=a[b];for(var d in c)c.hasOwnProperty(d)&&this.x.setRequestHeader(d,c[d])}},a}(),Eureka=function(){function a(a){this.opts=a,this._model=new EurekaModel(a),this._view=new EurekaView,this._controller=new EurekaController({model:this._model,view:this._view}),this._model.setController(this._controller),this._view.setController(this._controller),this._view.init(),this._view.paint(),this._controller.init(),this.fetch()}return a.prototype.fetch=function(){this._model.getDebug()&&console.log("fetch");var a=void 0!==this._model.getCurrentMediaSource()&&"/"!==this._model.getCurrentMediaSource()&&""!==this._model.getCurrentMediaSource()?!0:!1;this._model.setCurrentMediaSource(this._model.getCurrentMediaSource(),!0,void 0,!a,!0),a&&this._model.setCurrentDirectory(this._model.getCurrentDirectory(),!0,!0,!0)},a}(),EurekaMediaSource=function(){function a(a){this.opts=a,this._id="",this._title="",void 0!==a.id&&(this._id=a.id),void 0!==a.title&&(this._title=a.title)}return a.prototype.getID=function(){return this._id},a.prototype.setID=function(a){this._id=a},a.prototype.getTitle=function(){return this._title},a.prototype.setTitle=function(a){this._title=a},a.prototype.toString=function(){return this.getID()},a}(),EurekaModel=function(){function a(a){this._uid="media-browser_0",this._sources=[],this._navTreeHidden=!1,this._useLocalStorage=!0,this._currentDirectory=void 0,this._currentView="view-a",this._locale="en-US",this._selected="",this._editable=!0,this._headers=[],this._debug=!1,this._confirmBeforeDelete=!0,this._displayFullTreePaths=!1,this._allowRename=!0,this._allowDelete=!0,this._directoryRequestURL="",this._listSourceRequestURL="",this._listSourcesRequestURL="",this.getXHRHeaders=function(){return this._headers},void 0!==a.uid&&(this._uid=a.uid),void 0!==a.locale&&(this._locale=a.locale),void 0!==a.mediaSource&&(this._mediaSource=a.mediaSource),void 0!==a.currentDirectory&&(this._currentDirectory=a.currentDirectory),void 0!==a.headers&&(this._headers=a.headers),void 0!==a.navTreeHidden&&(this._navTreeHidden=a.navTreeHidden),void 0!==a.useLocalStorage&&(this._useLocalStorage=a.useLocalStorage),void 0!==a.currentView&&(this._currentView=a.currentView),void 0!==a.selected&&(this._selected=a.selected),void 0!==a.displayFullTreePaths&&(this._displayFullTreePaths=a.displayFullTreePaths),void 0!==a.allowRename&&(this._allowRename=a.allowRename),void 0!==a.allowDelete&&(this._allowDelete=a.allowDelete),void 0!==a.directoryRequestURL&&(this._directoryRequestURL=a.directoryRequestURL),void 0!==a.listSourceRequestURL&&(this._listSourceRequestURL=a.listSourceRequestURL),void 0!==a.listSourcesRequestURL&&(this._listSourcesRequestURL=a.listSourcesRequestURL),void 0!==a.fileUploadURL&&(this._fileUploadURL=a.fileUploadURL),a.debug===!0&&(this._debug=a.debug),void 0!==a.confirmBeforeDelete&&(this._confirmBeforeDelete=a.confirmBeforeDelete),this._useLocalStorage&&(this.getLocalStorage("currentMediaSource")&&!a.mediaSource&&(this._mediaSource=this.getLocalStorage("currentMediaSource")),this.getLocalStorage("navTreeHidden")&&!a.navTreeHidden&&(this._navTreeHidden="true"==this.getLocalStorage("navTreeHidden")?!0:!1),this.getLocalStorage("currentDirectory")&&!a.currentDirectory&&(this._currentDirectory=this.getLocalStorage("currentDirectory")),this.getLocalStorage("currentView")&&!a.currentView&&(this._currentView=this.getLocalStorage("currentView")))}return Object.defineProperty(a,"EurekaFoundIt",{get:function(){return"EurekaFoundIt"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaFileRename",{get:function(){return"EurekaFileRename"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaUnlink",{get:function(){return"EurekaUnlink"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaDirectoryCreated",{get:function(){return"EurekaDirectoryCreated"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaDirectoryOpened",{get:function(){return"EurekaDirectoryOpened"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaDirectoryChanged",{get:function(){return"EurekaDirectoryChanged"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaMediaSourceChange",{get:function(){return"EurekaMediaSourceChange"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaMediaSourcesListChange",{get:function(){return"EurekaMediaSourcesListChange"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EurekaViewChange",{get:function(){return"EurekaViewChange"},enumerable:!0,configurable:!0}),a.prototype.getLocalStorage=function(a){return void 0!==localStorage.getItem(a)&&"undefined"!==localStorage.getItem(a)?localStorage.getItem(a):!1},a.prototype.useLocalStorage=function(){return this._useLocalStorage},a.prototype.getAlertBeforeDelete=function(){return this._confirmBeforeDelete},a.prototype.getFileUploadURL=function(){return this._fileUploadURL},a.prototype.setFileUploadURL=function(a){this._fileUploadURL=a},a.prototype.setAlertBeforeDelete=function(a){this._confirmBeforeDelete=a},a.prototype.getDebug=function(){return this._debug},a.prototype.setDebug=function(a){this._debug=a},a.prototype.getHeaders=function(){return this._headers},a.prototype.getUID=function(){return this._uid},a.prototype.getSources=function(){return this._sources},a.prototype.getEditable=function(){return this._editable},a.prototype.getDisplayFullTreePaths=function(){return this._displayFullTreePaths},a.prototype.getAllowRename=function(){return this._allowRename},a.prototype.getAllowDelete=function(){return this._allowDelete},a.prototype.getMediaSourceDTOByID=function(a){this.getDebug()&&console.log("getMediaSourceDTOByID: "+a);for(var b=this.getSources(),c=0;c<b.length;c++){var d=b[c];if(d.getID()==a)return d}return this.getDebug()&&console.log("no media source found with id: "+a),null},a.prototype.getController=function(){return this._controller},a.prototype.setController=function(a){this._controller=a},a.prototype.getNavTreeHidden=function(){return this._navTreeHidden},a.prototype.setNavTreeHidden=function(a){this._navTreeHidden=a,this._useLocalStorage&&localStorage.setItem("navTreeHidden",a)},a.prototype.setCurrentMediaSource=function(b,c,d,e,f){if(void 0===c&&(c=!0),void 0===d&&(d=!0),void 0===e&&(e=!0),void 0===f&&(f=!1),this.getDebug()&&console.log("setCurrentMediaSource"),(this._mediaSource!==b||f)&&(this._mediaSource=b,d&&localStorage.setItem("currentMediaSource",b),c!==!1)){var g=document.createEvent("CustomEvent");g.initCustomEvent(a.EurekaMediaSourceChange,!0,!0,{currentDirectory:this.getCurrentDirectory(),currentMediaSource:this.getMediaSourceDTOByID(this._mediaSource),clearDirectory:e}),this.getController().getView().getElement().dispatchEvent(g)}},a.prototype.getCurrentMediaSource=function(){return this._mediaSource},a.prototype.setCurrentDirectory=function(b,c,d,e){if(void 0===c&&(c=!0),void 0===d&&(d=!0),void 0===e&&(e=!1),void 0===d&&(d=this.useLocalStorage()),(this._currentDirectory!==b||e)&&(this._currentDirectory=b,d&&b&&localStorage.setItem("currentDirectory",b),c!==!1)){var f=document.createEvent("CustomEvent");f.initCustomEvent(a.EurekaDirectoryChanged,!0,!0,{currentDirectory:b,currentMediaSource:this.getMediaSourceDTOByID(this._mediaSource)}),this.getController().getView().getElement().dispatchEvent(f)}},a.prototype.getCurrentDirectory=function(){return this._currentDirectory||"/"},a.prototype.setCurrentView=function(b,c){if(void 0===c&&(c=!0),this._currentView!==b&&(this._currentView=b,this._useLocalStorage&&localStorage.setItem("currentView",b),c!==!1)){var d=document.createEvent("CustomEvent");d.initCustomEvent(a.EurekaViewChange,!0,!0,{currentView:b}),this.getController().getView().getElement().dispatchEvent(d)}},a.prototype.getCurrentView=function(){return this._currentView},a.prototype.setLocale=function(a){this._locale=a},a.prototype.getLocale=function(){return this._locale},a.prototype.setSources=function(b,c){if(void 0===c&&(c=!0),this.getDebug()&&console.log("setSources"+c),this._sources=b,c!==!1){var d=document.createEvent("CustomEvent");d.initCustomEvent(a.EurekaMediaSourcesListChange,!0,!0,{sources:b}),this.getDebug()&&console.log("setSources"),this.getController().getView().getElement().dispatchEvent(d)}},a.prototype.setMediaSourcesData=function(a){this.getDebug()&&console.log("setMediaSourcesData"),a=JSON.parse(a);for(var b=a.results,c=[],d=0;d<b.length;d++){var e=b[d],f=new EurekaMediaSource({id:e.id,title:e.name});c.push(f)}this.setSources(c)},a.prototype.renameFile=function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent("EurekaFileRename",!0,!0,{fileName:a,newFilename:b,cs:this.getController().getModel().getCurrentMediaSource(),cd:this.getController().getModel().getCurrentDirectory(),path:this.getController().getModel().getCurrentDirectory()+a,newPath:this.getController().getModel().getCurrentDirectory()+b}),this.getController().getView().getElement().dispatchEvent(c)},a.prototype.deleteFile=function(a,b){var c=this,d=document.createEvent("CustomEvent");d.initCustomEvent("EurekaUnlink",!0,!0,{filename:b.getAttribute("data-filename"),timestamp:b.getAttribute("data-timestamp"),src:b.querySelector(".image img").getAttribute("src"),dimensions:[b.getAttribute("data-dimensions-w"),b.getAttribute("data-dimensions-h")],filesize:parseInt(b.getAttribute("data-filesize-bytes"))}),c.getController().getView().getElement().dispatchEvent(d)},a.prototype.setChoosenMediaItem=function(a){function b(a){for(var b=c.getController().getView().getElement().querySelectorAll("tr.eureka__row"),d=0;d<b.length;d++){var e=b[d];if(e.getAttribute("data-filename")==a)return e}return null}var c=this,d=b(a),e=document.createEvent("CustomEvent");e.initCustomEvent("EurekaFoundIt",!0,!0,{filename:a,timestamp:d.getAttribute("data-timestamp"),src:d.querySelector(".image img").getAttribute("src"),dimensions:[d.getAttribute("data-dimensions-w"),d.getAttribute("data-dimensions-h")],filesize:parseInt(d.getAttribute("data-filesize-bytes"))}),c.getController().getView().getElement().dispatchEvent(e)},a.prototype.getSelected=function(){return this._selected},a.prototype.setSelected=function(a){this._selected=a},a.prototype.getListDirectoryRequestURL=function(){return this._directoryRequestURL},a.prototype.setListDirectoryRequestURL=function(a){this._directoryRequestURL=a},a.prototype.getListSourceRequestURL=function(){return this._listSourceRequestURL},a.prototype.setListSourceRequestURL=function(a){this._listSourceRequestURL=a},a.prototype.getListSourcesRequestURL=function(){return this._listSourcesRequestURL},a.prototype.setListSourcesRequestURL=function(a){this._listSourcesRequestURL=a},a}(),EurekaView=function(){function a(){}return a.prototype.getController=function(){return this._controller},a.prototype.setController=function(a){this._controller=a},a.prototype.getElement=function(){return document.getElementById(this.getController().getModel().getUID())},a.prototype.assignFooterProceedListeners=function(){var a=this;a.getElement().parentNode.querySelector("footer.proceed button.cta").addEventListener("click",function(b){b.preventDefault(),a.getController().getModel().setChoosenMediaItem(a.getController().getModel().getSelected())})},a.prototype.init=function(){function a(){document.addEventListener("keydown",function(a){function b(a,b){function c(){for(var c=a.querySelectorAll("optgroup"),d=0;d<c.length;d++){var e=c[d];if(e.getAttribute("data-source")==b)return e}return null}var d=c();d&&(a.value=d.querySelector("option").value)}function c(b,c){function d(a){for(var c=b.querySelectorAll("option"),d=0;d<c.length;d++)if(c[d].value==a)return!0;return!1}d((a.which-48).toString())&&(b.value=c)}if(d.getController().getModel().getDebug()&&console.log(a),a.ctrlKey&&186===a.which){var e=document.createEvent("Event");e.initEvent("click",!0,!0),document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle").dispatchEvent(e)}if(a.altKey&&a.ctrlKey&&a.which>=48&&a.which<=57)try{var f=d.getElement().querySelectorAll(".view-btns > nav > a"),g=f[a.which-48-1];if(g){var e=document.createEvent("Event");e.initEvent("click",!0,!0),g.dispatchEvent(e)}}catch(a){}if(a.altKey&&!a.ctrlKey&&a.which>=48&&a.which<=57&&(c(document.getElementById(d.getController().getModel().getUID()+"__mediasource-select"),(a.which-48).toString()),b(document.getElementById(d.getController().getModel().getUID()+"__browsing"),(a.which-48).toString())),8===a.which&&document.activeElement){var e=document.createEvent("Event");e.initEvent("click",!0,!0);try{document.activeElement.nextSibling.querySelector("a.trash").dispatchEvent(e)}catch(a){}}if(a.altKey&&32===a.which&&document.activeElement)try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),document.activeElement.nextSibling.querySelector("a.expand").dispatchEvent(e)}catch(a){}if(13===a.which&&document.activeElement)try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),document.activeElement.nextSibling.querySelector("a.choose").dispatchEvent(e)}catch(a){}if(a.ctrlKey&&82===a.which)try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),document.activeElement.nextSibling.querySelector("a.rename").dispatchEvent(e)}catch(a){}if(a.ctrlKey&&78===a.which)try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.getElement().querySelector(".create-new").dispatchEvent(e)}catch(a){}if(a.ctrlKey&&85===a.which)try{var e=document.createEvent("Event");e.initEvent("click",!0,!0),document.getElementById(d.getController().getModel().getUID()+"__upload-input").dispatchEvent(e)}catch(a){}if(a.ctrlKey&&70===a.which)try{document.getElementById(d.getController().getModel().getUID()+"__filter-images").focus()}catch(a){}})}function b(){var a=document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle"),b=document.getElementById(a.getAttribute("data-toggle-target"));b.classList.remove("hidden"),document.getElementById(d.getController().getModel().getUID()).classList.add("sidebar-open"),d.getElement().querySelector(".browse-select").classList.add("tablet-p-hidden"),d.getController().getModel().setNavTreeHidden(!1);var c=document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle").getElementsByTagName("i")[0];c.classList.remove("fa-toggle-right"),c.classList.remove("icon-toggle-right"),c.classList.add("fa-toggle-left"),c.classList.add("icon-toggle-left"),a.title=a.getAttribute("data-title-close")}function c(){var a=document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle"),b=document.getElementById(a.getAttribute("data-toggle-target"));b.classList.add("hidden"),document.getElementById(d.getController().getModel().getUID()).classList.remove("sidebar-open"),d.getElement().querySelector(".browse-select").classList.remove("tablet-p-hidden"),d.getController().getModel().setNavTreeHidden(!0);var c=document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle").getElementsByTagName("i")[0];c.classList.add("fa-toggle-right"),c.classList.add("icon-toggle-right"),c.classList.remove("fa-toggle-left"),c.classList.remove("icon-toggle-left"),a.title=a.getAttribute("data-title-open")}var d=this;document.getElementById(d.getController().getModel().getUID()+"__pathbrowser_toggle").addEventListener("click",function(a){var d=document.getElementById(this.getAttribute("data-toggle-target"));a.preventDefault(),d.classList.contains("hidden")?b():c()}),this.assignViewButtonListeners(),this.assignFooterProceedListeners(),this.assignBrowsingSelectOptGroupListeners(),this.assignMediaBrowserOptGroupListeners(),this.assignSelectListeners(),this.assignSortBtnListeners(),this.assignFilterListeners(),this.assignCreateNewDirectoryListener(),this.assignUploadListeners(),a();var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.getElement().querySelector('.eureka__topbar-nav .view-btns a[data-view="'+d.getController().getModel().getCurrentView()+'"]').dispatchEvent(e),this.getController().getModel().getNavTreeHidden()===!0&&c();var f=document.getElementById(d.getController().getModel().getUID()).querySelector(".dropzone")||null;if(void 0!==html5Upload&&!Modernizr.touch&&html5Upload.fileApiSupported()&&f?html5Upload.initialize({uploadUrl:d.getController().getModel().getFileUploadURL(),dropContainer:f,inputField:document.getElementById(d.getController().getModel().getUID()+"__upload-input"),key:"File",maxSimultaneousUploads:4,onFileAdded:function(a){function b(){for(var a=f.querySelector(".progress").querySelectorAll("h2,p"),b=0;b<a.length;b++)a[b].remove()}b();var c=a.fileName.replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,"")+a.fileSize.toString().replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,""),e=document.createElement("div");e.classList.add("bar"),e.setAttribute("id",c),e.title=a.fileName+" is preparing for upload.";var g=document.createElement("div");g.setAttribute("style","right:100%"),e.appendChild(g);var h=document.getElementById(d.getController().getModel().getUID()).querySelector(".dropzone");h.classList.remove("complete"),h.classList.add("uploading"),h.querySelector(".progress").appendChild(e),a.on({onCompleted:function(b){e.setAttribute("title",a.fileName+" has uploaded"),h.querySelectorAll(".bar").length>=2&&e.remove(),h.querySelectorAll(".bar").length<2&&setInterval(function(){h.querySelector(".progress").innerHTML="",h.classList.remove("uploading"),h.classList.add("complete"),function(){var a=h.querySelector(".progress"),b=document.createElement("h2"),c=document.createElement("i");c.setAttribute("class","fa fa-check-circle-o icon icon-check-circle-o"),b.appendChild(c),a.appendChild(b);var d=document.createElement("span");d.setAttribute("title","files here..."),d.innerHTML="Your files";var e=document.createElement("p");e.appendChild(d),e.innerHTML+=' have been successfully uploaded.<br><a href="#">Upload&nbsp;more.</a>',a.appendChild(e)}()},640)},onProgress:function(b,c,d){b=Math.ceil(b),e.setAttribute("title",a.fileName+" is "+b+"% uploaded"),g.setAttribute("style","right:"+(100-b).toString()+"%")}})}}):f&&f.remove(),void 0===d.getController().getModel().getFileUploadURL()||""==d.getController().getModel().getFileUploadURL()){try{d.getElement().querySelector(".pathbrowser footer form").remove()}catch(a){}try{d.getElement().querySelector(".upload-form").remove()}catch(a){}}void 0!==d.getController().getModel().getCurrentMediaSource()&&"/"!==d.getController().getModel().getCurrentMediaSource()&&""!==d.getController().getModel().getCurrentMediaSource()&&d.recursivelyOpenTreeToCurrentDirectory()},a.prototype.recursivelyOpenTreeToCurrentDirectory=function(){for(var a=this,b=document.getElementById(a.getController().getModel().getUID()+"__pathbrowser"),c=b.querySelectorAll("a.path"),d=0;d<c.length;d++){var e=c[d];e.getAttribute("data-cd").split("/").toString()==a.getController().getModel().getCurrentDirectory().split("/").toString()&&!function(){function a(a){a.classList.remove("fa-folder"),a.classList.remove("icon-folder"),a.classList.add("fa-folder-open"),a.classList.add("icon-folder-open")}e.parentNode.classList.add("active"),e.parentNode.classList.add("open");var b=getParents(e,"ul");if(b.length>1)for(var c=0;c<b.length;c++){var d=b[c].parentNode;d.classList.add("open"),a(d.querySelector(".folder > i"))}}()}return!1},a.prototype.assignUploadListeners=function(){var a=this;a.getElement().querySelector(".pathbrowser .upload-files").addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),function(){var b=document.createEvent("Event");b.initEvent("click",!0,!0),document.getElementById(a.getController().getModel().getUID()+"__upload-input").dispatchEvent(b)}()})},a.prototype.assignBrowsingSelectOptGroupListeners=function(){var a=this;a.getController().getModel().getDebug()&&console.log("assignBrowsingSelectOptGroupListeners");var b=document.getElementById(a.getController().getModel().getUID()+"__browsing").querySelector("select");b.addEventListener("change",function(b){var c=a.getSelectedOption(this),d=a.getClosest(c,"optgroup"),e=d.getAttribute("data-source");a.getController().getModel().setCurrentMediaSource(e,!1,a.getController().getModel().useLocalStorage()),a.getController().getModel().setCurrentDirectory(c.getAttribute("value"),!0,a.getController().getModel().useLocalStorage())})},a.prototype.assignCreateNewDirectoryListener=function(){var a=this;a.getElement().querySelector(".create-new").addEventListener("click",function(b){function c(b){if(13===b.keyCode){b.preventDefault(),b.stopPropagation(),this.blur(),this.setAttribute("contenteditable","false"),a.getElement().querySelector("button.create-new").focus();var c=this.innerHTML,b=document.createEvent("CustomEvent");b.initCustomEvent("EurekaDirectoryCreated",!0,!0,{newdirectory:c,cd:a.getController().getModel().getCurrentDirectory(),s:a.getController().getModel().getCurrentMediaSource(),path:a.getController().getModel().getCurrentDirectory()+c}),a.getElement().dispatchEvent(b)}}var d=document.createElement("li"),e=document.createElement("a");e.classList.add("folder"),e.innerHTML='&nbsp;<i class="fa icon fa-folder icon-folder"></i>';var f=document.createElement("a");f.classList.add("path"),f.setAttribute("title","Browse this directory"),f.setAttribute("data-cd",""),f.setAttribute("contenteditable","true"),f.innerHTML="new folder",d.appendChild(e),d.appendChild(f),d.appendChild(document.createElement("ul")),setTimeout(function(){f.focus();try{f.select()}catch(a){}},240);var g=a.getElement().querySelector(".pathbrowser .tree li.active > ul")||a.getElement().querySelector(".pathbrowser .tree > ul");g.classList.add("open"),g.parentNode.classList.add("open");try{g.previousSibling.previousSibling.querySelector(".fa").setAttribute("class","fa icon fa-folder-open icon-folder-open")}catch(a){}f.addEventListener("focus",function(a){this.addEventListener("keydown",c,!1)},!1),f.addEventListener("blur",function(a){this.removeEventListener("keydown",c,!1)},!1),g.appendChild(d)})},a.prototype.assignViewButtonListeners=function(){function a(a){for(var b=document.querySelectorAll(".eureka__topbar-nav .view-btns a[data-view]"),c=0;c<b.length;c++){var d=b[c];d.classList.remove("current")}a.classList.add("current")}for(var b=this.getController().getModel(),c=document.querySelectorAll(".eureka__topbar-nav .view-btns a[data-view]"),d=0;d<c.length;d++){var e=c[d];e.addEventListener("click",function(c){c.preventDefault();for(var d=this,e=this.getAttribute("data-view"),f=["view-a","view-b","view-c","view-d"],g=0;g<f.length;g++){var h=f[g];document.getElementById(d.getAttribute("data-view-target")).classList.remove(h)}document.getElementById(d.getAttribute("data-view-target")).classList.add(e),a(d),b.setCurrentView(e)},!0)}},a.prototype.assignARIAKeyListeners=function(){var a=this;!function(){function b(b){for(var c=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),d=0;d<c.length;d++){var e=c[d];b!==e&&e.classList.contains("focused")&&e.classList.remove("focused")}b.classList.add("focused");var f=a.getProceedFooter().querySelector("button.cta");f.removeAttribute("disabled"),f.classList.remove("muted"),f.classList.add("go"),a.getController().getModel().setSelected(b.getAttribute("data-filename"))}function c(b){var c=document.getElementById("eureka_contextual__"+b.getAttribute("data-safe-filename"));c.focus();var d=a.getProceedFooter().querySelector("button.cta");d.classList.remove("go"),d.setAttribute("disabled"),d.classList.add("muted")}for(var d=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),e=0;e<d.length;e++){var f=d[e];f.addEventListener("focus",function(a){a.preventDefault(),b(this)},!1),f.addEventListener("blur",function(a){c(this)},!1)}}()},a.prototype.assignSortBtnListeners=function(){function a(a){a.preventDefault(),a.stopPropagation(),this.setAttribute("data-sort-asc",Math.abs(parseInt(this.getAttribute("data-sort-asc"))-1).toString());for(var c=this.getAttribute("data-sortby"),d="1"==this.getAttribute("data-sort-asc")?!0:!1,e=[],f=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),g=0;g<f.length;g++)e.push(f[g]);switch(c){case"dimensions":e.sort(function(a,b){return parseInt(a.getAttribute("data-dimensions-w"))*parseInt(a.getAttribute("data-dimensions-h"))-parseInt(b.getAttribute("data-dimensions-w"))*parseInt(b.getAttribute("data-dimensions-h"))});break;case"filesize":e.sort(function(a,b){return parseInt(a.getAttribute("data-filesize-bytes"))-parseInt(b.getAttribute("data-filesize-bytes"))});break;case"editedon":e.sort(function(a,b){return parseInt(a.getAttribute("data-timestamp"))-parseInt(b.getAttribute("data-timestamp"))});break;default:e.sort(function(a,b){return a.getAttribute("data-filename")>b.getAttribute("data-filename")?1:a.getAttribute("data-filename")<b.getAttribute("data-filename")?-1:0})}d||e.reverse();for(var h="",i=0;i<e.length;i++){var j=e[i];h+=j.outerHTML}b.getElement().querySelector(".eureka-table tbody").innerHTML=h}for(var b=this,c=document.querySelectorAll(".eureka-table th .fa-sort"),d=0;d<c.length;d++){var e=c[d];e.removeEventListener("click",a,!0),e.addEventListener("click",a,!0)}},a.prototype.assignFilterListeners=function(){function a(){for(var a=document.querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),b=0;b<a.length;b++){var d=a[b];d.classList.remove("hidden")}document.getElementById(c.getController().getModel().getUID()).querySelector(".eureka-table > table > tbody").classList.remove("filtered")}function b(a){for(var b=c.getElement().querySelectorAll(".eureka-table tbody > tr:not(.contextual)"),d=0;d<b.length;d++){var e=b[d],f=!1,g=[e.getAttribute("data-filename")];e.getAttribute("data-tokens")&&(g=g.concat(e.getAttribute("data-tokens").split("||"))),function(){for(var b=0;b<g.length;b++){var c=g[b];if(a.length&&(c==a||c.indexOf(a)>-1)){f=!0;break}}}(),f?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")),document.getElementById(c.getController().getModel().getUID()).querySelector(".eureka-table > table > tbody").classList.add("filtered")}}var c=this,d=document.getElementById(c.getController().getModel().getUID()+"__filter-images");d.addEventListener("input",function(c){this.value?b(this.value):a()},!1)},a.prototype.populateTree=function(a){function b(a,d){for(var e=0;e<a.length;e++){var f=a[e],g=f.path.split("/");g=g.filter(function(a){return void 0!==a&&""!=a});var h=g.join("/");c.getController().getModel().getDisplayFullTreePaths()?"/"==h[h.length-1]&&(h=h.substring(0,h.length-1)):h=g[g.length-1];var i=document.createElement("li"),j=document.createElement("a");j.classList.add("folder");var k=document.createElement("i");k.classList.add("fa"),k.classList.add("icon"),k.classList.add("fa-folder"),k.classList.add("icon-folder"),k.classList.add("folder"),j.appendChild(k),j.innerHTML+="&nbsp;";var l=document.createElement("a");l.innerHTML=" "+h,l.setAttribute("title","Browse "+f.path),l.setAttribute("data-cd",f.path),l.classList.add("path"),i.appendChild(j),i.appendChild(l);var m=document.createElement("ul");i.appendChild(m),void 0!==f.children&&f.children.length&&(b(f.children,m),i.appendChild(m)),d.appendChild(i)}}var c=this;a=JSON.parse(a);var d=a.results,e=document.querySelector("#"+this.getController().getModel().getUID()+"__pathbrowser nav.tree > ul");this.emptyTree(),e.innerHTML="",b(d,e),this.assignTreeListeners()},a.prototype.getProceedFooter=function(){return this.getElement().parentNode.querySelector("footer.proceed")},a.prototype.handleTreePathClicked=function(a){function b(){for(var a=document.querySelectorAll("nav.tree a.path"),b=0;b<a.length;b++){var d=a[b],e=c.getClosest(d,"li");

e.classList.remove("active")}}var c=this;c.getController().getModel().getDebug()&&console.log("handleTreePathClicked: "+(a.getAttribute("data-cd")||"/")),c.getController().getModel().setCurrentDirectory(a.getAttribute("data-cd")||"/",!0,void 0);var d=c.getController().getModel().getCurrentMediaSource(),e=new AJAX;e.get(c.getController().getModel().getListDirectoryRequestURL(),{s:d,dir:a.getAttribute("data-cd")||"/"},function(a){c.paintJSON(a)},!0,c.getController().getModel().getXHRHeaders());var f=c.getClosest(a,"li");b(),f.classList.add("active")},a.prototype.assignTreeListeners=function(){for(var a=this,b=document.querySelectorAll("nav.tree a.path"),c=0;c<b.length;c++){var d=b[c];d.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a.handleTreePathClicked(this)})}this.assignTreeFolderListeners()},a.prototype.assignMediaBrowserOptGroupListeners=function(){var a=this;a.getController().getModel().getDebug()&&console.log("assignMediaBrowserOptGroupListeners");var b=a.getElement().querySelector("#"+a.getController().getModel().getUID()+"__browsing select");b.addEventListener("change",function(){a.getController().getModel().getDebug()&&console.log("#"+a.getController().getModel().getUID()+" change");var c=a.getSelectedOption(b);a.getController().getModel().setCurrentMediaSource(a.getClosest(c,"optgroup").getAttribute("data-source"),!0,a.getController().getModel().useLocalStorage());var d=new AJAX;d.get(a.getController().getModel().getListSourceRequestURL(),{s:a.getController().getModel().getCurrentMediaSource()},function(b){a.getController().getView().populateTree(b)},!0,a.getController().getModel().getXHRHeaders())})},a.prototype.assignTreeFolderListeners=function(){for(var a=this,b=document.querySelectorAll("nav.tree a.folder"),c=0;c<b.length;c++){var d=b[c];d.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation();var c=this.querySelector(".fa"),d=c.classList.contains("fa-folder-open"),e=a.getClosest(this,"li"),f=this.nextSibling.getAttribute("data-cd")||"/";if(d)c.classList.remove("fa-folder-open"),c.classList.remove("icon-folder-open"),c.classList.add("fa-folder"),c.classList.add("icon-folder"),e.classList.remove("open");else{c.classList.remove("fa-folder"),c.classList.remove("icon-folder"),c.classList.add("fa-folder-open"),c.classList.add("icon-folder-open"),e.classList.add("open");var b=document.createEvent("CustomEvent");b.initCustomEvent(EurekaModel.EurekaDirectoryOpened,!0,!0,{cd:a.getController().getModel().getCurrentDirectory(),s:a.getController().getModel().getCurrentMediaSource(),path:f}),a.getElement().dispatchEvent(b)}})}},a.prototype.assignSelectListeners=function(){var a=this,b=a.getElement().querySelector("#"+a.getController().getModel().getUID()+"__mediasource-select");b.addEventListener("change",function(){a.getController().getModel().setCurrentMediaSource(this.value,!0,a.getController().getModel().useLocalStorage()),a.getController().getModel().setCurrentDirectory(this.value,!1,a.getController().getModel().useLocalStorage());var b=new AJAX;b.get(a.getController().getModel().getListSourceRequestURL(),{s:a.getController().getModel().getCurrentMediaSource()},function(b){a.getController().getView().populateTree(b)},!0,a.getController().getModel().getXHRHeaders())})},a.prototype.emptyTree=function(){for(var a=document.querySelectorAll("nav.tree a.path"),b=0;b<a.length;b++){var c=a[b];c.removeEventListener("click"),c.remove()}},a.prototype.assignDraggableListeners=function(){for(var a=document.querySelectorAll('*[sorta-draggable="true"]'),b=0;b<a.length;b++){var c=a[b];c.addEventListener("blur",function(a){this.parentNode.draggable=!1}),c.addEventListener("focus",function(a){this.parentNode.draggable=!1})}},a.prototype.assignChooseClickListeners=function(){function a(a){a.querySelector("div.image").addEventListener("dblclick",function(c){var d=this;!function(){var c=document.createEvent("CustomEvent");c.initCustomEvent("EurekaFoundIt",!0,!0,{filename:a.getAttribute("data-filename"),timestamp:a.getAttribute("data-timestamp"),src:d.querySelector("img").getAttribute("src"),dimensions:[a.getAttribute("data-dimensions-w"),a.getAttribute("data-dimensions-h")],filesize:parseInt(a.getAttribute("data-filesize-bytes"))}),b.getController().getView().getElement().dispatchEvent(c)}()})}var b=this;b.getController().getModel().getDebug()&&console.log("assignChooseClickListeners");for(var c=b.getElement().querySelectorAll("tr.eureka__row"),d=0;d<c.length;d++)a(c[d])},a.prototype.paint=function(){this.assignARIAKeyListeners(),this.assignContextualClickListeners(),this.assignDraggableListeners(),this.assignChooseClickListeners()},a.prototype.paintTree=function(a){function b(a,d){for(var e=0;e<a.length;e++){var f=a[e],g=document.createElement("li"),h=document.createElement("a");h.innerHTML="&nbsp;",h.classList.add("folder");var i=document.createElement("i");i.classList.add("fa"),i.classList.add("icon"),i.classList.add("fa-folder"),i.classList.add("icon-folder"),h.appendChild(i);var j=document.createElement("a");j.classList.add("path"),j.setAttribute("href","#"),j.setAttribute("title","Browse "+f.path);var k=f.path.split("/");k=k.filter(function(a){return void 0!==a&&""!=a});var l=k.join("/");c.getController().getModel().getDisplayFullTreePaths()?"/"==l[l.length-1]&&(l=l.substring(0,l.length-1)):l=k[k.length-1],j.setAttribute("data-cd",f.path),j.innerHTML=" "+l,g.appendChild(h),g.appendChild(j);var m=document.createElement("ul");g.appendChild(m),void 0!==f.children&&f.children.length&&b(f.children,m),d.appendChild(g)}}var c=this;a=JSON.parse(a);var d=c.getElement().querySelector("nav.tree"),e=a.results;d.innerHTML="";var f=document.createElement("ul");d.appendChild(f),b(e,f),this.assignTreeListeners(),this.recursivelyOpenTreeToCurrentDirectory()},a.prototype.paintJSON=function(a){function b(a){var b=document.createElement("code");return b.innerHTML=a,b}function c(){function a(){function a(){var a=document.createElement("a");a.classList.add("expand"),a.setAttribute("href",l),a.setAttribute("title","Expand "+j),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-expand"),b.classList.add("icon-expand"),a.appendChild(b),a.innerHTML+=" Expand",a}function b(){var a=document.createElement("a");a.classList.add("choose"),a.setAttribute("title","Choose "+j),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-check-circle-o"),b.classList.add("icon-check-circle-o"),a.appendChild(b),a.innerHTML+=" Choose",a}function c(){var a=document.createElement("a");a.classList.add("rename"),a.setAttribute("title","Rename "+j),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-edit"),b.classList.add("icon-edit"),a.appendChild(b),a.innerHTML+=" Rename",a}function e(){var a=document.createElement("a");a.classList.add("dangerous"),a.classList.add("trash"),a.setAttribute("title","Delete "+j),a.setAttribute("target","_blank"),a.setAttribute("tabindex","0");var b=document.createElement("i");return b.classList.add("fa"),b.classList.add("icon"),b.classList.add("fa-trash"),b.classList.add("icon-trash"),a.appendChild(b),a.innerHTML+=" Delete",a}var f=document.createElement("nav");return f.classList.add("flexible_row"),f.classList.add("contextual__nav"),f.appendChild(a()),f.appendChild(b()),d.getController().getModel().getAllowRename()&&document.execCommand&&f.appendChild(c()),d.getController().getModel().getAllowDelete()&&f.appendChild(e()),f}var b=document.createElement("tr");b.classList.add("contextual"),b.setAttribute("id","eureka_contextual__"+k);var c=document.createElement("td");return c.setAttribute("colspan","4"),c.appendChild(a()),b.appendChild(c),b}var d=this;d.getController().getModel().getDebug()&&console.log("paintJSON"),a=JSON.parse(a);for(var e=this.getController().getModel(),f=a.results,g="",h=0;h<f.length;h++){var i=f[h],j=i.filename,k=j.replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,""),l=i.src,m=i.filesize,n=i.dimensions,o=parseInt(i.editedon),p=document.createElement("tr");p.classList.add("eureka__row"),p.setAttribute("tabindex","0"),p.setAttribute("data-tokens",""),p.setAttribute("data-filename",j),p.setAttribute("data-safe-filename",k),p.setAttribute("data-dimensions-w",n.split("x")[0]),p.setAttribute("data-dimensions-h",n.split("x")[1]),p.setAttribute("data-filesize-bytes",m),p.setAttribute("data-timestamp",o.toString());var q=document.createElement("td");q.setAttribute("contenteditable","false"),q.classList.add("eureka__row-image");var r=document.createElement("div");r.classList.add("image");var s=document.createElement("img");s.setAttribute("src",l),r.appendChild(s);var t=document.createElement("code");t.setAttribute("contenteditable","true"),t.setAttribute("tabindex","-1"),t.setAttribute("sorta-draggable","true"),t.innerHTML=j,q.appendChild(r),q.appendChild(t);var u=document.createElement("td");u.classList.add("eureka__row-dimensions"),u.appendChild(b(n));var v=document.createElement("td");v.classList.add("eureka__row-filesize"),v.appendChild(b(d.formatFileSize(m)));var w=document.createElement("td");w.classList.add("eureka__row-editedon"),w.appendChild(b(new Date(1e3*o).toLocaleDateString(e.getLocale(),{month:"short",day:"numeric",year:"numeric"}))),p.appendChild(q),p.appendChild(u),p.appendChild(v),p.appendChild(w),g+=p.outerHTML,g+=c().outerHTML}document.querySelector("#"+this.getController().getModel().getUID()+" .eureka-table > table > tbody").innerHTML=g;try{this.getElement().querySelector("nav.tree li.active").classList.remove("active")}catch(a){}try{this.getElement().querySelector('nav.tree li > a[data-cd="'+a.cd+'"]').parentNode.classList.add("active")}catch(a){}try{this.getElement().querySelector(".pathbrowser__topbar > select").value=a.cs}catch(a){}this.paint()},a.prototype.assignContextualClickListeners=function(){function a(){function a(a){var b=d.getClosest(a,"tr"),c=b.previousSibling;d.getController().getModel().setChoosenMediaItem(c.getAttribute("data-filename"))}for(var b=d.getElement().querySelectorAll("tr.contextual a.choose"),c=0;c<b.length;c++){var e=b[c];e.addEventListener("click",function(b){b.preventDefault(),a(this)},!1),e.addEventListener("focus",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.add("go"),d.getElement().parentNode.querySelector("footer.proceed .cta").disabled=!1,d.getElement().parentNode.querySelector("footer.proceed .cta").removeAttribute("disabled")},!1),e.addEventListener("blur",function(a){d.getElement().parentNode.querySelector("footer.proceed .cta").classList.remove("go")},!1)}}function b(){function a(a){function b(a){try{a.remove()}catch(b){a.parentNode.removeChild(a)}}var c=d.getClosest(a,"tr"),e=c.previousSibling,f=c.nextSibling;if(d.getController().getModel().getAlertBeforeDelete()&&!window.confirm("Are you sure you want to delete "+e.getAttribute("data-filename")+"?"))return!1;d.getController().getModel().deleteFile(e.getAttribute("data-filename"),e),b(e),b(c);try{f.focus()}catch(a){}}function b(b){13===b.keyCode&&a(this)}for(var c=document.querySelectorAll("tr.contextual a.trash"),e=0;e<c.length;e++){var f=c[e];f.addEventListener("click",function(b){a(this)},!1),f.addEventListener("focus",function(a){this.addEventListener("keydown",b,!1)},!1),f.removeEventListener("blur",function(a){this.removeEventListener("keydown",b,!1)},!1)}}function c(){function a(a){{var e=c(this);d.getClosest(this,".contextual").previousSibling}13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),b(e))}function b(a){a.focus();try{a.select()}catch(a){}}function c(a){var b=d.getClosest(a,"tr"),c=b.previousSibling,e=c.querySelector('.eureka__row-image code[contenteditable="true"]');return e}for(var e=document.querySelectorAll("tr.contextual a.rename"),f=0;f<e.length;f++){var g=e[f];g.addEventListener("click",function(a){a.preventDefault();var d=c(this);b(d)},!1),g.addEventListener("focus",function(b){this.addEventListener("keydown",a,!1)},!1),g.addEventListener("blur",function(b){this.removeEventListener("keydown",a,!1)},!1)}}var d=this;d.assignContexualCodeFocusListeners(),a(),c(),b()},a.prototype.assignContexualCodeFocusListeners=function(){function a(a){if(13===a.keyCode){a.preventDefault();var c=this.parentNode.parentNode,d=c.nextSibling,f=c.getAttribute("data-filename");e.contentEditable="false";var g=this.innerHTML;b.getController().getModel().renameFile(f,g);var h=d.querySelector("nav > a.rename");return h.focus(),window.getSelection().collapse(h,0),!1}return!0}for(var b=this,c=this.getElement().querySelectorAll('tr.eureka__row .eureka__row-image code[contenteditable="true"]'),d=0;d<c.length;d++){var e=c[d];e.addEventListener("focus",function(){this.addEventListener("keydown",a,!1)},!1)}},a.prototype.sortBrowseSelectOptGroupsByMediaSourceId=function(a){void 0===a&&(a=document.getElementById(this.getController().getModel().getUID()+"__browsing").querySelector("select"));for(var b=[],c=a.querySelectorAll("optgroup"),d=0;d<c.length;d++)b.push(c[d]);var e=b.sort(function(a,b){return parseInt(a.getAttribute("data-source"))-parseInt(b.getAttribute("data-source"))});a.innerHTML="";for(var f=0;f<e.length;f++){var g=e[f];a.appendChild(g)}},a.prototype.updateMediaSourceListings=function(a){function b(){d.getController().getModel().getDebug()&&console.log("updateTreeSelect");var b=document.getElementById(d.getController().getModel().getUID()+"__mediasource-select"),c=null;try{c=b.querySelector('option[value="'+e+'"]')}catch(a){}c||(c=document.createElement("option"),c.setAttribute("value",e),c.innerHTML=a.title,b.appendChild(c))}function c(){function b(a){for(var c=0;c<a.length;c++){var d=a[c],e=document.createElement("option");e.innerHTML=d.path,e.setAttribute("value",d.path),h.push(e),d.children&&d.children.length&&b(d.children)}}d.getController().getModel().getDebug()&&console.log("updateTopBarSelect");var c=document.getElementById(d.getController().getModel().getUID()+"__browsing").querySelector("select");d.getController().getModel().getDebug()&&console.log(c);var f=null;try{f=c.querySelector('optgroup[data-source="'+e+'"]')}catch(a){}f||(f=document.createElement("optgroup"),f.setAttribute("label",a.title),f.setAttribute("data-source",e));var g=a.results,h=[];b(g),f.innerHTML="";for(var i=0;i<h.length;i++){var j=h[i];f.appendChild(j)}c.appendChild(f),d.sortBrowseSelectOptGroupsByMediaSourceId(c)}var d=this;d.getController().getModel().getDebug()&&(console.log("updateMediaSourceListings: "),console.log(a)),a=JSON.parse(a);{var e=a.cs;this.getController().getModel().getMediaSourceDTOByID(e)}b(),c()},a.prototype.getSelectedOption=function(a){for(var b=a.querySelectorAll("option"),c=0;c<b.length;c++){var d=b[c];if(d.selected)return d}},a.prototype.formatFileSize=function(a){for(var b=[" Bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=1;c<b.length;c++)if(a<Math.pow(1024,c))return Math.round(a/Math.pow(1024,c-1)*100)/100+b[c-1];return a.toString()},a.prototype.getClosest=function(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return null},a}(),EurekaController=function(){function a(a){this.opts=a,this._model=a.model,this._view=a.view}return a.prototype.getModel=function(){return this._model},a.prototype.getView=function(){return this._view},a.prototype.init=function(){var a=this,b=a.getView().getElement();b.addEventListener(EurekaModel.EurekaViewChange,function(a){}),b.addEventListener(EurekaModel.EurekaDirectoryChanged,function(b){a.getModel().getDebug()&&console.log(EurekaModel.EurekaDirectoryChanged);var c=new AJAX;c.get(a.getModel().getListDirectoryRequestURL(),{s:a.getModel().getCurrentMediaSource(),dir:b.detail.currentDirectory||"/"},function(b){a.getModel().getDebug()&&console.log(b),a.getModel().setCurrentDirectory(b.cd,!1,a.getModel().useLocalStorage()),a.getView().paintJSON(b)},!0,a.getModel().getXHRHeaders())}),b.addEventListener(EurekaModel.EurekaMediaSourceChange,function(b){a.getModel().getDebug()&&console.log(EurekaModel.EurekaMediaSourceChange);var c=new AJAX;c.get(a.getModel().getListSourceRequestURL(),{s:b.detail.currentMediaSource},function(c){a.getModel().getDebug()&&console.log(c),a.getView().paintTree(c),1==b.detail.clearDirectory&&a.getModel().setCurrentDirectory("",!0,!1)},!0,a.getModel().getXHRHeaders())}),b.addEventListener(EurekaModel.EurekaMediaSourcesListChange,function(b){function c(b){a.getModel().getDebug()&&console.log("requestMediaListings");var c=b.getID(),d=new AJAX;d.get(a.getModel().getListSourceRequestURL(),{s:c},function(b){a.getModel().getDebug()&&console.log(b),a.getView().updateMediaSourceListings(b)},!0,a.getModel().getXHRHeaders())}a.getModel().getDebug()&&console.log("MediaSourcesListChange: ");for(var d=b.detail.sources,e=0;e<d.length;e++){{var f=new EurekaMediaSource(d[e].opts);f.getID()}c(f)}}),a.getModel().getDebug()&&console.log("MediaSourcesListChange listener added"),function(){a.getModel().getDebug()&&console.log("MediaSourcesListChange: ");var b=new AJAX;b.get(a.getModel().getListSourcesRequestURL(),{},function(b){a.getModel().getDebug()&&console.log(b),a.getModel().setMediaSourcesData(b)},!0,a.getModel().getXHRHeaders())}()},a}();